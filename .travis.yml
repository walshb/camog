# Copyright 2019 Ben Walsh
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

addons:
  apt:
    packages:
      - pandoc
      - libpcre3
install:
  - pip install cython numpy pytest
script:
  - python .ci/build_and_test.py
deploy:
  provider: pypi
  user: walshb
  password:
    secure: Ejhvmkp3P1I3Xp2pZAS3tholZCdlIm81GTQP/4mctqkZibm8HiNvJenBCZ8M+dPoIQk0OmKByWwKfEMob8MFnY3x0sUfqzKBiFEi31LdAYGnEGXCE1XqgKX0An9hmOHDky01rddPdI7pxlbbTFDcGO9LOurrf8lrS+mq2+ks7ROhCjQTOMs1oElKTo8Bri3/bN4W4esoOt5TgWMa5yu/5BuRXSxSYJzq8svjEQ6HzdSbqAu1kYEn1hAJRImnkT8jZZ2jZsqxGDqMWxI95DLNXj9aNwrKpMeHtJ4a5vThEMl9GxcM8hON2p1xWsEjVetjS+h3fo79gEdXUpPQ/pLtHL3En6/WLosRWQHtdw/kpftXUgbfWkQMDigChbKMshzkZtzL6MdQHolK4jGpZD0jkjWxm20yVX9HuLGtinV84eErq6Ytx9x8BMvGiZ4jr1x6r4/pgQUmemZzDVu5AIQkLsr22eBJkOlQv0ZASNsNWEdCWEz8D2D6iMeVnbxTGa+U/aeH4LkPnsnHjcYWwk6JK1v2Th0RLUAZUW+kZK0r03wVxjtqpeL6nJDOrPeeblgwzaLsh1Qrj8j1yuRzN3WfdX5+2SiV8mFs1DxGm4jue7mFPexXrf+UECSO8XDKcEDh4OrDvdC2pby6ZtNMfMnuLwhl7Ag1KXPVw7iKdZ7useo=
  distributions: "sdist bdist_egg"
  skip_cleanup: true
  on:
    tags: true
after_deploy:
  - .ci/install_swig.sh
  - export PATH=$(/bin/pwd)/extern_pkgs/swig/bin:$PATH
  - cd benchmarks
  - make
matrix:
  include:
    - language: python
      python: 2.7
    - language: python
      python: 3.4
    - language: python
      python: 3.5
    - language: python
      python: 3.6
    - os: linux
      language: r
      before_install:
        - cd lang/r
        - make setup
        - cd build/camog
      install:
        - Rscript -e 'install.packages("devtools"); devtools::install_deps(dependencies = TRUE)'
      script:
        - R CMD build .
        - R CMD check *tar.gz
      deploy:
        provider: script
        script: /bin/true
      after_deploy:
        - /bin/true
    - os: osx
      osx_image: xcode11.2  # Python 3.7.4 running on macOS 10.14.4
      language: shell
      before_install:
        - uname -a
        - .ci/virtualenv.sh --system-site-packages myenv
        - . myenv/bin/activate
      install:
        - pip install numpy pytest
      script:
        - python .ci/build_and_test.py
      after_deploy:
        - /usr/bin/true
